<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TBM Bus Tracker Avancé</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #007bff;
            color: white;
            padding: 10px;
            text-align: center;
        }
        main {
            padding: 20px;
        }
        .line, .stop, .bus {
            margin-bottom: 10px;
        }
        .line {
            font-weight: bold;
        }
        .bus {
            font-style: italic;
        }
    </style>
</head>
<body>
    <header>
        <h1>Suivi des Bus TBM</h1>
    </header>
    <main>
        <div id="lines"></div>
        <div id="stops"></div>
        <div id="buses"></div>
        <div id="alerts"></div>
    </main>
    <script>
        // Fonction pour récupérer les données GTFS statiques
        async function fetchGTFSData(url) {
            const response = await fetch(url);
            const data = await response.json();
            return data;
        }

        // Fonction pour récupérer les données GTFS-RT
        async function fetchGTFSRTData(url) {
            const response = await fetch(url);
            const data = await response.json();
            return data;
        }

        // Fonction pour afficher les lignes de bus
        async function displayLines() {
            const linesData = await fetchGTFSData('https://bdx.mecatran.com/utw/ws/gtfsfeed/static/bordeaux?apiKey=opendata-bordeaux-metropole-flux-gtfs-rt');
            const linesContainer = document.getElementById('lines');
            linesData.routes.forEach(line => {
                const lineDiv = document.createElement('div');
                lineDiv.classList.add('line');
                lineDiv.textContent = `Ligne ${line.route_short_name}: ${line.route_long_name}`;
                linesContainer.appendChild(lineDiv);
            });
        }

        // Fonction pour afficher les arrêts de bus
        async function displayStops() {
            const stopsData = await fetchGTFSData('https://bdx.mecatran.com/utw/ws/gtfsfeed/static/bordeaux?apiKey=opendata-bordeaux-metropole-flux-gtfs-rt');
            const stopsContainer = document.getElementById('stops');
            stopsData.stops.forEach(stop => {
                const stopDiv = document.createElement('div');
                stopDiv.classList.add('stop');
                stopDiv.textContent = `Arrêt: ${stop.stop_name}`;
                stopsContainer.appendChild(stopDiv);
            });
        }

        // Fonction pour afficher les positions des bus
        async function displayBuses() {
            const busesData = await fetchGTFSRTData('https://transport.data.gouv.fr/resources/83026');
            const busesContainer = document.getElementById('buses');
            busesData.entity.forEach(entity => {
                const bus = entity.vehicle;
                const busDiv = document.createElement('div');
                busDiv.classList.add('bus');
                busDiv.textContent = `Bus ${bus.vehicle.id} - Position: (${bus.position.latitude}, ${bus.position.longitude})`;
                busesContainer.appendChild(busDiv);
            });
        }

        // Fonction pour afficher les alertes de service
        async function displayAlerts() {
            const alertsData = await fetchGTFSRTData('https://transport.data.gouv.fr/resources/83026');
            const alertsContainer = document.getElementById('alerts');
            alertsData.entity.forEach(entity => {
                const alert = entity.alert;
                const alertDiv = document.createElement('div');
                alertDiv.classList.add('alert');
                alertDiv.textContent = `Alerte: ${alert.header_text}`;
                alertsContainer.appendChild(alertDiv);
            });
        }

        // Appeler les fonctions pour afficher les données
        displayLines();
        displayStops();
        displayBuses();
        displayAlerts();
    </script>
</body>
</html>
